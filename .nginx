# This file is only a reference and won't be used automatically.
# If you're using NGINX, copy these rules into your server block
# It provides rewrite rules similar to .htaccess for clean URLs.

location / {
    try_files $uri $uri/ /index.php?$query_string;

    if ($arg_slug) {
        rewrite ^/post/index\.php$ /post/$arg_slug? permanent;
        rewrite ^/project/index\.php$ /project/$arg_slug? permanent;
    }

    rewrite ^/login/?$ /usr/login.php last;
    rewrite ^/register/?$ /usr/register.php last;
    rewrite ^/logout/?$ /usr/logout.php last;
    rewrite ^/forgot-password/?$ /usr/forgot_password.php last;
    rewrite ^/edit-profile/?$ /usr/edit_profile.php last;
    rewrite ^/change-password/?$ /usr/password.php last;
    rewrite ^/erase-account/?$ /usr/erase.php last;
    rewrite ^/settings/?$ /manage/settings.php last;
    rewrite ^/statistics/?$ /statistics/index.php last;
    rewrite ^/statistics/members/?$ /statistics/members.php last;
    rewrite ^/statistics/full-report/?$ /statistics/full.php last;
    rewrite ^/posts/?$ /view/posts.php last;
    rewrite ^/library/?$ /manage/library.php last;
    rewrite ^/send-announcements/?$ /manage/sendtoall.php last;
    rewrite ^/manage/?$ /manage/index.php last;
    rewrite ^/manage/add-post/?$ /manage/add_post.php last;
    rewrite ^/manage/add-project/?$ /manage/add_project.php last;
    rewrite ^/manage/backup/?$ /manage/backup.php last;
    rewrite ^/terms/?$ /usr/terms.php last;
    rewrite ^/backup/?$ /includes/backup.php last;

    rewrite ^/styles/?$ /styles/index.php last;
    rewrite ^/styles/add/?$ /styles/add.php last;
    rewrite ^/styles/edit/([0-9]+)/?$ /styles/edit.php?id=$1 last;
    rewrite ^/styles/delete/([0-9]+)/?$ /styles/delete.php?id=$1 last;
    rewrite ^/styles/backup/?$ /styles/backup.php last;

    rewrite ^/post/([^/]+)/?$ /view/post.php?slug=$1 last;
    rewrite ^/project/([^/]+)/?$ /view/project.php?slug=$1 last;
    rewrite ^/@([^/]+)/?$ /usr/profile.php?username=$1 last;
    rewrite ^/manage/edit-post/([0-9]+)/?$ /manage/edit_post.php?id=$1 last;
    rewrite ^/manage/edit-project/([0-9]+)/?$ /manage/edit_project.php?id=$1 last;
    rewrite ^/manage/delete/(post|project)/([0-9]+)/?$ /manage/delete_item.php?type=$1&id=$2 last;
    rewrite ^/manage/delete-user/([0-9]+)/?$ /manage/delete_user.php?id=$1 last;

    rewrite ^/manage/home/?$ /manage/home.php last;
    rewrite ^/projects/?$ /view/projects.php last;

    rewrite ^/activate/?$ /usr/activate.php?$query_string last;
    rewrite ^/reset-password/?$ /usr/reset_password.php?$query_string last;
    
    rewrite ^/sitemap.xml$ /includes/sitemap.php last;
    rewrite ^/robots.txt$ /includes/robots.php last;
}
