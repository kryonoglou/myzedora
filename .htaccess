RewriteEngine On
RewriteBase /

# Redirects for old query-based URLs to new pretty URLs
RewriteCond %{QUERY_STRING} ^slug=([^&]+)$
RewriteRule ^view/post\.php$ /post/%1? [R=301,L]

RewriteCond %{QUERY_STRING} ^slug=([^&]+)$
RewriteRule ^view/project\.php$ /project/%1? [R=301,L]

# Pretty URL to PHP file mapping
RewriteRule ^login/?$ usr/login.php [L]
RewriteRule ^register/?$ usr/register.php [L]
RewriteRule ^logout/?$ usr/logout.php [L]
RewriteRule ^forgot-password/?$ usr/forgot_password.php [L]
RewriteRule ^edit-profile/?$ usr/edit_profile.php [L]
RewriteRule ^change-password/?$ usr/password.php [L]
RewriteRule ^erase-account/?$ usr/erase.php [L]
RewriteRule ^settings/?$ manage/settings.php [L]
RewriteRule ^statistics/?$ statistics/index.php [L]
RewriteRule ^statistics/members/?$ statistics/members.php [L]
RewriteRule ^statistics/full-report/?$ statistics/full.php [L]
RewriteRule ^posts/?$ view/posts.php [L]
RewriteRule ^projects/?$ view/projects.php [L]
RewriteRule ^library/?$ manage/library.php [L]
RewriteRule ^send-announcements/?$ manage/sendtoall.php [L]
RewriteRule ^manage/?$ manage/index.php [L]
RewriteRule ^manage/add-post/?$ manage/add_post.php [L]
RewriteRule ^manage/add-project/?$ manage/add_project.php [L]
RewriteRule ^manage/backup/?$ manage/backup.php [L]
RewriteRule ^manage/home/?$ manage/home.php [L]
RewriteRule ^terms/?$ usr/terms.php [L]
RewriteRule ^backup/?$ includes/backup.php [L]

# Style Management
RewriteRule ^styles/?$ styles/index.php [L]
RewriteRule ^styles/add/?$ styles/add.php [L]
RewriteRule ^styles/edit/([0-9]+)/?$ styles/edit.php?id=$1 [L]
RewriteRule ^styles/delete/([0-9]+)/?$ styles/delete.php?id=$1 [L]
RewriteRule ^styles/backup/?$ styles/backup.php [L]

# Rules with parameters
RewriteRule ^post/([^/]+)/?$ view/post.php?slug=$1 [L]
RewriteRule ^project/([^/]+)/?$ view/project.php?slug=$1 [L]
RewriteRule ^@([^/]+)/?$ usr/profile.php?username=$1 [L]
RewriteRule ^manage/edit-post/([0-9]+)/?$ manage/edit_post.php?id=$1 [L]
RewriteRule ^manage/edit-project/([0-9]+)/?$ manage/edit_project.php?id=$1 [L]
RewriteRule ^manage/delete/(post|project)/([0-9]+)/?$ manage/delete_item.php?type=$1&id=$2 [L]
RewriteRule ^manage/delete-user/([0-9]+)/?$ manage/delete_user.php?id=$1 [L]

# Rules that need the query string appended
RewriteRule ^activate/?$ usr/activate.php [L,QSA]
RewriteRule ^reset-password/?$ usr/reset_password.php [L,QSA]

# Sitemap and Robots
RewriteRule ^sitemap\.xml$ includes/sitemap.php [L]
RewriteRule ^robots\.txt$ includes/robots.php [L]

# Front Controller
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule . index.php [L]
